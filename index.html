<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>OSSC CGL Study Planner</title>

<style>
:root{
  --bg:#0f172a; --card:#1e293b; --text:#e5e7eb;
  --accent:#38bdf8; --done:#22c55e; --pending:#f97316; --danger:#ef4444;
}
*{box-sizing:border-box;font-family:system-ui}
body{margin:0;background:var(--bg);color:var(--text);padding:15px}
h1{text-align:center}

.card{background:var(--card);padding:15px;border-radius:16px;margin-bottom:15px}

.summary-box{
  background:#0f172a;
  border:1px solid #334155;
  border-radius:12px;
  padding:12px;
  margin:15px 0;
}

.summary-row{
  display:flex;
  justify-content:space-between;
  font-weight:600;
}

.completed{
  color:white;
}

.pending{
  color:black;
}

input,select,button{
 width:100%;padding:10px;border-radius:10px;border:none;margin-top:8px
}
button{background:var(--accent);font-weight:600;cursor:pointer}

.stats{display:flex;gap:10px;margin-top:10px}
.stat{flex:1;text-align:center;padding:8px;border-radius:10px;font-weight:700}
.pending{background:var(--pending)}
.completed{background:var(--done)}

.countdown{text-align:center;font-weight:700}
.danger{color:var(--danger)}

table{
 width:100%;border-collapse:collapse;margin-top:10px;font-size:14px
}
th,td{
 border:1px solid #334155;padding:6px;text-align:center
}
th{background:#020617}

.chapter{
 background:#020617;padding:10px;border-radius:12px;margin-top:10px
}
.row{display:flex;justify-content:space-between;align-items:center}

.warning-box{
  background:#7c2d12;
  color:#fde68a;
  padding:10px;
  border-radius:10px;
  margin-bottom:10px;
  font-weight:600;
  text-align:center;
}


/* ---------- RESPONSIVE DESIGN ---------- */
@media (max-width: 1200px) {
  body {
    padding: 10px;
    font-size: 14px;
  }
  h1 {
    font-size: 22px;
  }
  .card {
    padding: 12px;
  }
  table th, table td {
    padding: 4px;
    font-size: 12px;
  }
  input, select, button {
    padding: 8px;
    font-size: 13px;
  }
  .stats .stat {
    font-size: 12px;
    padding: 6px;
  }
}

@media (max-width: 900px) {
  body {
    padding: 8px;
  }
  h1 {
    font-size: 20px;
  }
  table {
    font-size: 11px;
  }
  table th, table td {
    padding: 3px;
  }
  .card {
    padding: 10px;
  }
  input, select, button {
    padding: 6px;
    font-size: 12px;
  }
  .stats {
    flex-direction: column;
    gap: 5px;
  }
  .stats .stat {
    width: 100%;
    font-size: 12px;
    padding: 6px;
  }
}

</style>
</head>

<body>

<h1>üìò OSSC CGL Study Planner</h1>

<!-- EXAM DATE -->
<div class="card">
<label>üéØ Exam Date</label>
<input type="date" id="examDate">
<div id="countdown" class="countdown"></div>
</div>

<!-- OVERALL SUMMARY -->
<div id="overallSummary" class="summary-box">
  <h3>üìö Overall Progress</h3>
  <div class="summary-row">
    <span id="overallCompleted">‚úî Completed: 0 (0%)</span>
    <span id="overallPending">‚è≥ Pending: 0 (0%)</span>
  </div>
  <button onclick="resetProgress()" style="margin-top:10px;background:#ef4444;color:white;">üîÑ Reset Progress</button>
</div>


<div id="dailyWarning" class="warning-box" style="display:none;">
  ‚ö†Ô∏è Today study plan is not completed yet!
</div>

<!-- TODAY SCHEDULE -->
<div class="card">
<h3>üïí Today Study Schedule</h3>

<table>
<thead>
<tr>
<th>Sl</th>
<th>Subject</th>
<th>Chapter</th>
<th>Time</th>
<th>Done</th>
</tr>
</thead>
<tbody id="todayBody"></tbody>
</table>

<div class="stats">
<div class="stat completed">Completed Today: <span id="tDone">0</span></div>
<div class="stat pending">Pending Today: <span id="tPending">0</span></div>
</div>
</div>

<!-- SUBJECT -->
<div class="card">
  <select id="subjectSelect">
  <option value="">-- Select Subject --</option>
  <option>Arithmetic</option>
  <option>Reasoning</option>
  <option>Data Interpretation</option>
  <option>Computer</option>
  <option>Current Affairs</option>
  <option>Odisha GK</option>
</select>


  <!-- Add new chapter -->
  <div style="margin-top:10px;">
    <input type="text" id="newChapterInput" placeholder="‚ûï Add new chapter">
    <button onclick="addChapter()" style="margin-top:5px;background:#22c55e;color:white;">Add Chapter</button>
  </div>

  <div class="stats">
    <div class="stat pending">Pending: <span id="pCount">0</span></div>
    <div class="stat completed">Completed: <span id="cCount">0</span></div>
  </div>
</div>


<div id="chapterList"></div>

<script>
/* ---------- DATA ---------- */
const syllabus = {
  "Arithmetic": [
    "Number System",
    "Percentage",
    "Ratio & Proportion",
    "Profit & Loss",
    "Simple Interest",
    "Compound Interest",
    "Speed, Time & Distance",
    "Time & Work",
    "Averages",
    "Mensuration",
    "Partnership & Mixtures"
  ],

  "Reasoning": [
    "Series (Number & Letter)",
    "Analogies",
    "Classification",
    "Coding-Decoding",
    "Directions",
    "Blood Relation",
    "Seating Arrangement",
    "Syllogism"
  ],

  "Data Interpretation": [
    "Tables",
    "Bar Graphs",
    "Pie Charts",
    "Line Graphs",
    "Data Sufficiency"
  ],

  "Computer": [
    "MS Office (Word, Excel, PPT)",
    "OS & Software Basics",
    "Internet & Networking",
    "Keyboard Shortcuts"
  ],

  "Current Affairs": [
    "October CA",
    "November CA",
    "December CA",
    "January CA"
  ],

  "Odisha GK": [
    "Odisha History",
    "Odisha Geography",
    "Odisha Polity",
    "Odisha Economy",
    "Odisha Static GK"
  ]
};


let data=JSON.parse(localStorage.getItem("syllabus"))||{};
const todayKey=new Date().toDateString();
const timeSlots = [
  { start: "06:00", end: "07:00" },
  { start: "07:15", end: "08:15" },
  { start: "08:30", end: "09:30" },
  { start: "09:30", end: "10:30" },
  { start: "10:30", end: "12:00" },
  { start: "12:00", end: "13:00" },
  { start: "14:30", end: "15:30" },
  { start: "15:30", end: "16:30" },
  { start: "16:30", end: "17:30" },
  { start: "17:30", end: "18:30" },
  { start: "19:00", end: "20:00" },
  { start: "20:00", end: "21:00" }
];


/* ---------- EXAM COUNTDOWN ---------- */
const examDate = document.getElementById("examDate");
const countdown = document.getElementById("countdown");

examDate.value = localStorage.getItem("examDate")||"";
examDate.onchange = () => {
  localStorage.setItem("examDate",examDate.value);
};

setInterval(()=>{
 if(!examDate.value){countdown.textContent="Set exam date"; return;}
 const d = Math.floor((new Date(examDate.value) - new Date())/86400000);
 countdown.textContent = d<=0 ? "üéâ Exam Day" : `‚è≥ ${d} Days Left`;
 countdown.className="countdown"+(d<=7?" danger":"");

 // Notification if exam < 7 days
 if(d > 0 && d <= 7){notify(`‚è≥ Exam in ${d} days!`, "Get ready for OSSC CGL");}
},1000);


//-----------Reset------------ //

function resetProgress(){
  if(!confirm("‚ö†Ô∏è Are you sure you want to reset all progress?")) return;

  // Reset every chapter
  Object.keys(data).forEach(sub=>{
    data[sub].forEach(ch=>{
      ch.done = false;
      ch.rev = 0;
      ch.last = null;
    });
  });

  // Clear today plan
  localStorage.removeItem("todayPlan");
  localStorage.removeItem("todayPlanDate");
  localStorage.warned = "";

  save();
  generateTodayPlan();
  render();
}


//---------Subject Input----------- //

function addChapter(){
  const s = subjectSelect.value;
  const input = document.getElementById("newChapterInput");
  const chapterName = input.value.trim();

  if(!s){
    alert("Please select a subject first!");
    return;
  }
  if(!chapterName){
    alert("Please enter chapter name!");
    return;
  }

  // Initialize subject data if not exists
  if(!data[s]){
    data[s] = [];
  }

  // Add new chapter
  data[s].push({name: chapterName, rev: 0, last: null, done: false});

  save();
  input.value = ""; // clear input
  render(); // update UI
}

// Initialize all subjects and chapters if not already in localStorage
Object.keys(syllabus).forEach(sub => {
  if(!data[sub] || !Array.isArray(data[sub])){
    data[sub] = syllabus[sub].map(ch => ({name:ch, rev:0, last:null, done:false}));
  }
});
save();


subjectSelect.onchange = () => {
  render(); // just render the selected subject's chapters
};


/* ---------- SUBJECT INIT ---------- */
function generateTodayPlan(){
  const today = new Date().toDateString();
  if(localStorage.todayPlanDate === today){
    renderTodayPlan();
    return;
  }

  const subjects = ["Arithmetic","Reasoning","Data Interpretation","Computer","Current Affairs","Odisha GK"];
  let pool = [];

  // Step 1: Take one chapter per subject (incomplete first)
  subjects.forEach(sub=>{
    if(data[sub]){
      const incomplete = data[sub].filter(ch=>!ch.done);
      let chapter;
      if(incomplete.length>0){
        // pick a random incomplete chapter
        chapter = incomplete[Math.floor(Math.random()*incomplete.length)];
      } else {
        // pick random chapter for revision
        chapter = data[sub][Math.floor(Math.random()*data[sub].length)];
      }
      const idx = data[sub].indexOf(chapter);
      pool.push({subject: sub, index: idx, rev: chapter.rev || 0});
    }
  });

  // Step 2: Fill remaining time slots with other incomplete chapters
  let allIncomplete = [];
  Object.keys(data).forEach(sub=>{
    data[sub].forEach((ch,i)=>{
      if(!ch.done && !pool.some(p=>p.subject===sub && p.index===i)){
        allIncomplete.push({subject: sub, index:i, rev: ch.rev||0});
      }
    });
  });

  allIncomplete.sort(()=>Math.random()-0.5);
  pool = pool.concat(allIncomplete);

  // Step 3: Fill only up to available time slots
  const totalSlots = Math.min(timeSlots.length, pool.length);
  let planToday = [];
  for(let i=0;i<totalSlots;i++){
    planToday.push({
      subject: pool[i].subject,
      index: pool[i].index,
      time: `${timeSlots[i].start} ‚Äì ${timeSlots[i].end}`,
      done:false
    });
  }

  localStorage.todayPlan = JSON.stringify(planToday);
  localStorage.todayPlanDate = today;
  localStorage.warned = "";

  renderTodayPlan();
}



/* ---------- COMPLETE TODAY ---------- */
function completeToday(i){
  let plan = JSON.parse(localStorage.todayPlan);
  plan[i].done = !plan[i].done;
  if(plan[i].done){
    const p = plan[i];
    data[p.subject][p.index].rev++;
    data[p.subject][p.index].last = Date.now();
  }
  localStorage.todayPlan = JSON.stringify(plan);
  save();
  renderTodayPlan();
  updateOverallSummary();
}

/* ---------- DAILY WARNING ---------- */
function checkDailyWarning(){
  const hour = new Date().getHours();
  const box = document.getElementById("dailyWarning");

  if(hour < 20){ box.style.display="none"; return; }

  let plan = JSON.parse(localStorage.todayPlan || "[]");
  let incomplete = plan.some(p=>!p.done);
  box.style.display = incomplete ? "block" : "none";

  if(incomplete){
    box.style.display = "block";
    if(localStorage.warned !== "true"){   // check string explicitly
      alert("‚ö†Ô∏è Your today's study plan is still incomplete!");
      localStorage.warned = "true";
      notify("‚ö†Ô∏è Today's study plan incomplete", "Complete your schedule today!");
    }
  } else {
    box.style.display = "none";
  }

}

if(localStorage.todayPlanDate !== new Date().toDateString()) localStorage.warned="";

/* ---------- RENDER FUNCTIONS ---------- */
function renderTodayPlan(){
  const body = document.getElementById("todayBody");
  body.innerHTML = "";

  let plan = JSON.parse(localStorage.todayPlan || "[]");
  let done=0, pending=0;

  const now = new Date();
  const currentMinutes = now.getHours()*60 + now.getMinutes();

  plan.forEach((p,i)=>{
    if(p.done) done++; else pending++;

    const [startH, startM] = p.time.split("‚Äì")[0].trim().split(":").map(Number);
    const [endH, endM] = p.time.split("‚Äì")[1].trim().split(":").map(Number);
    const startMinutes = startH*60 + startM;
    const endMinutes = endH*60 + endM;

    const isActive = currentMinutes >= startMinutes && currentMinutes < endMinutes;

    body.innerHTML += `
      <tr style="background:${isActive ? '#38bdf880' : 'transparent'}">
        <td>${i+1}</td>
        <td>${p.subject}</td>
        <td>${data[p.subject][p.index].name}</td>
        <td>${p.time}</td>
        <td><input type="checkbox" ${p.done?"checked":""} onchange="completeToday(${i})"></td>
      </tr>
    `;
  });

  document.getElementById("tDone").textContent = done;
  document.getElementById("tPending").textContent = pending;
}


setInterval(renderTodayPlan, 60000); // refresh active row highlight every minute


function render(){
  renderTodayPlan();
  updateOverallSummary();
  const s = subjectSelect.value;
  if(!data[s]) return;

  const chapterList = document.getElementById("chapterList");
  chapterList.innerHTML="";
  let p=0,c=0;

  data[s].forEach((ch,i)=>{
    ch.done ? c++ : p++;
    chapterList.innerHTML += `
      <div class="chapter">
        <div class="row"><b>${i+1}. ${ch.name}</b><small>Rev: ${ch.rev}</small></div>
        <div class="row">
          <button onclick="incRevision(${i})">üîÅ Rev +</button>
          <button onclick="toggleChapter(${i})">${ch.done ? "Completed" : "Pending"}</button>
        </div>
      </div>
    `;
  });

  document.getElementById("pCount").textContent = p;
  document.getElementById("cCount").textContent = c;
}

function incRevision(i){
  const s = subjectSelect.value;
  data[s][i].rev++;
  data[s][i].last = Date.now();
  save();
  render();
}

function toggleChapter(i){
  const s = subjectSelect.value;
  data[s][i].done = !data[s][i].done;
  save();
  render();
}

function updateOverallSummary(){
  const comp = document.getElementById("overallCompleted");
  const pend = document.getElementById("overallPending");

  if(!comp || !pend) return;

  let total = 0, done = 0;

  // Count all chapters in all subjects
  Object.keys(data).forEach(sub => {
    if(Array.isArray(data[sub])){
      total += data[sub].length;
      done += data[sub].filter(ch => ch.done).length;
    }
  });

  let pending = total - done;
  let donePct = total ? Math.round((done/total)*100) : 0;
  let pendPct = 100 - donePct;

  comp.innerText = `‚úî Completed: ${done} (${donePct}%)`;
  pend.innerText = `‚è≥ Pending: ${pending} (${pendPct}%)`;
}



/* ---------- SAVE ---------- */
function save(){localStorage.setItem("syllabus",JSON.stringify(data))}

/* ---------- NOTIFICATION FUNCTION ---------- */
function notify(title, body){
  if(!("Notification" in window)) return;
  if(Notification.permission === "granted"){
    new Notification(title,{body});
  }else if(Notification.permission !== "denied"){
    Notification.requestPermission().then(permission=>{
      if(permission==="granted") new Notification(title,{body});
    });
  }
}

/* ---------- INIT ---------- */
generateTodayPlan();
checkDailyWarning();
render();

setInterval(checkDailyWarning, 60000); // check every minute
</script>

</body>
</html>
